//
// PIMA.ino
//
// PIMA Decoder shows on the Serial Monitor.
//

#include <PIMA.h>

byte sample1[] = {0xAA,0x55,0x01,0x03,0x05,0x07,0x09,0x05,0x0A,0x02,0x02,0x22,0x22,0xB3,0xD0};
byte sample2[] = {0xAA,0x55,0x01,0x03,0x05,0x07,0x09,0x05,0x0A,0x51,0x01,0x11,0x11,0x06,0x71};
byte sample3[] = {0xAA,0x55,0x01,0x03,0x05,0x07,0x09,0x05,0x0A,0x07,0x03,0x33,0x33,0x2E,0x80};
byte sample4[] = {0xAA,0x55,0x01,0x03,0x05,0x07,0x09,0x05,0x0A,0x0C,0x04,0x44,0x44,0xFA,0xB3};
byte sample_len = 15;

void setup() {
  Serial.begin(115200);
  Serial.println("PIMA Decoder");
  
  PIMA.onMessage(pimaMessage);

  PIMA.write(sample1, sample_len);
  PIMA.write(sample2, sample_len);
  PIMA.write(sample3, sample_len);
  PIMA.write(sample4, sample_len);
}

void loop() {
  PIMA.loop();
}

void pimaMessage(PIMALayer pima)
{
  Serial.print("id : ");
  Serial.println(pima.id);
  Serial.print("index : ");
  Serial.println(pima.index , HEX);
  Serial.print("value : ");
  Serial.println(pima.value);
}
